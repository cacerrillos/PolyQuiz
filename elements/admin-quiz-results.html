<!doctype html>
<dom-module id="admin-quiz-results-page">
	<link rel="import" href="admin-quiz-results/admin-quiz-results-delete-overlay.html">
	<link rel="import" href="admin-quiz-results/admin-quiz-results-row.html">
	<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
	<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
	<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">
	<link rel="import" href="../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
	<link rel="import" href="../bower_components/neon-animation/animations/scale-up-animation.html">
	<link rel="import" href="../bower_components/neon-animation/animations/fade-out-animation.html">
	<style is="custom-style">
		paper-material {
			background-color: white;
			margin-top: 5px;
			margin-bottom: 5px;
		}
	</style>
	<template>
		<iron-ajax
				id="resultsAjax"
				url="../api/1.0/results.php"
				handle-as="json"
				on-response="resultContentReceived">	
			</iron-ajax>
		<div class="container" id="thisPageContainer">
			<div class="row">
				<div class="12u">
					<paper-material>
						<h2 class="nomargins">Results & Grading</h2>
						Sort By: <paper-button id="quizandhouse" on-click="onSortByQuizAndHouse" raised>Quiz & House</paper-button><paper-button id="session" on-click="onSortBySession" raised>Session</paper-button>
					</paper-material>
				</div>
				<div class="12u" id="loadPaperDiv">
					<paper-material id="loadPaper">
						<center><paper-spinner id="loadSpinner" active></paper-spinner></center>
					</paper-material>
				</div>
			</div>
				<template is="dom-repeat" items="[[_transformData(resultsObject)]]" as="quizzes">
					<div class="row">
						<div class="12u">
							<paper-material>
								<template is="dom-repeat" items="[[_transformData(quizzes.results)]]" as="houses">
								<h2>[[quizzes.name]]</h2>
									<div class="row">
										<div class="12u">
											<admin-quiz-results-row
												uuid=""
												firstname="First Name"
												lastname="Last Name"
												score="Score"
												freeresponsescore="Free Response Score"
												datetime="Date & Time"
												></admin-quiz-results-row>
											<template is="dom-repeat" items="[[_transformData(houses)]]" as="quizresults">
												<admin-quiz-results-row
													uuid="[[quizresults.uuid]]"
													firstname="[[quizresults.firstname]]"
													lastname="[[quizresults.lastname]]"
													score="[[quizresults.rawscore]]"
													possiblescore="[[quizresults.possiblescore]]"
													freeresponsescore="[[quizresults.frscore]]"
													freeresponsescorepossible="[[quizresults.frpossible]]"
													datetime="[[quizresults.timestamp]]"
													></admin-quiz-results-row>
											</template>
										</div>
									</div>
								</template>
							</paper-material>
						</div>
					</div>
				</template>
		</div>
	</template>
	<script>
		Polymer({
			is: "admin-quiz-results-page",
			properties: {
				uuid: String,
				_get: {
					type: Object
				},
				resultsObject: {
					type: Array
				}
			},
			resultContentReceived: function(response) {
				this.resultsObject = this.$.resultsAjax.lastResponse;
				this.$.loadPaperDiv.style.display = "none";
			},
			_transformData: function(data){
				var arr = $.map(data, function(el) { return el; })
				//console.log(arr);
				return arr;
			},
			_convertTimeStamp: function(data) {
				
			},
			_count: function(data){
				return data.length;
			},
			onSortByQuizAndHouse: function() {
				window.location = "?p=results";
			},
			onSortBySession: function(){
				window.location = "?p=results&sortby=session";
			},
			ready: function() {
				if(this._get.hasOwnProperty("uuid")){
					this.uuid = this._get["uuid"];
				} else {
					console.log("no uuid!");
				}
				if(this._get.hasOwnProperty("sortby")){
					if(this._get["sortby"] == "session"){
						this.$.session.disabled = true;
					} else {
						this.$.quizandhouse.disabled = true;
					}
				} else {
					this.$.quizandhouse.disabled = true;
				}
				this.$.resultsAjax.params = { "uuid": this.uuid };
				this.$.resultsAjax.generateRequest();
			}
		});
	</script>

</dom-module>