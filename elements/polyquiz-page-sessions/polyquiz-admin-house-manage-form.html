<!DOCTYPE html>
<dom-module id="polyquiz-admin-house-manage-form">
	<style is="custom-style">
		paper-material {
			background-color: white;
			margin-top: 5px;
			margin-bottom: 5px;
		}
		.validButton {
			background-color: #4285f4;
			color: rgba(255,255,255,1.00);
		}
	</style>
<template>
	<iron-ajax id="getHousesAjax" url="../../api/1.0/houses/houses.php" handle-as="json" on-response="housesResp" auto></iron-ajax>
	<iron-ajax id="createHouseAjax" url="../../api/1.0/house/create.php" handle-as="json" on-response="createResp"></iron-ajax>
	<paper-dialog>
		<paper-input label="Session Name" on-change="formDataChanged" id="houseName"></paper-input>
		<paper-button raised class="" on-click="reqSubmit">Create</paper-button>
		<paper-button raised class="" on-click="resetForm">Reset</paper-button>
	</paper-dialog>
	<div class="row">
		<div class="12u"><paper-button on-click="toggleForm" id="manageToggleButton" raised>Manage Houses</paper-button></div>
		<iron-collapse id="houseCollapse">
			<div class="12u"><paper-button raised>Add</paper-button></div>
			<div class="12u">
				<poly-dropdown-input id="" name="" objects="[[houses]]" defaulttext="Select A Quiz" raised on-selected-changed=""></poly-dropdown-input>
			</div>
			<div class="12u">
				<div class="row">
				</div>
			</div>
			
		</iron-collapse>
	</div>
</template>
<script>
Polymer({
	is: "polyquiz-admin-house-manage-form",
		properties: {
		quizzes: Object,
		houses: Object,
		selectedquiz: String,
		selectedhouse: String,
		sessionname: String,
		
	},
	toggleForm: function(e){
		this.$.houseCollapse.toggle();
		if(this.$.houseCollapse.opened){
			this.$.manageToggleButton.raised = false;
		} else {
			this.$.manageToggleButton.raised = true;
		}
	},
	housesResp: function(e){
		if(e.detail.response){
			console.log(e);
			var arr = [];
			var roww = function(id, text){
					this.id = id;
					this.text = text;
				};
			for(var x = 0; x < e.detail.response.length; x++){
				var tis = e.detail.response[x];
				arr.push(new roww(tis.data.houseId, tis.data.houseName));
			}
			if(arr.length > 0){
				this.houses = arr;
			}
		}
	},
	quizInfoResp: function(e){
		if(e.detail.response){
			var arr = [];
			var roww = function(id, text){
					this.id = id;
					this.text = text;
				};
			for(var x = 0; x < e.detail.response.length; x++){
				var tis = e.detail.response[x];
				arr.push(new roww(tis.uuid, tis.name));
			}
			if(arr.length > 0){
				this.quizzes = arr;
			}
		}
	},
	reqSubmit: function(e){
		this.$.createAjax.params = {
			sessionname: this.$.sessionName.value,
			house: this.$.houseSelector.value,
			quiz: this.$.quizSelector.value,
			status: this.$.status.selected,
			show: this.$.show.selected
		};
		this.$.createAjax.generateRequest();
		console.log(this.$.sessionName.value + " " + this.$.houseSelector.value + " " + this.$.quizSelector.value + " " + this.$.status.selected + " " + this.$.show.selected);
	},
	createResp: function(e){
		
		if(e.detail.response.status === true){
			this.resetForm();
			this.fire('iron-signal', {name: 'toast-event', data: { toastString: "Created a new Session!" } });
			this.fire("reload-sessions", { });
		} else {
			this.fire('iron-signal', {name: 'toast-event', data: { toastString: "FAILED to create a new Session!" } });
		}
		
		console.log(e);
	},
	resetForm: function(e){
		this.$.sessionName.value = "";
		this.$.houseSelector.selected = -1;
		this.$.quizSelector.selected = -1;
		this.$.status.selected = "open";
		this.$.show.selected = "show";
	},
	test: function(e){
		console.log(e);
	},
	formDataChanged: function(e){
		
	},
	ready: function(){
		this.formDataChanged();
	}
});
</script>
</dom-module>