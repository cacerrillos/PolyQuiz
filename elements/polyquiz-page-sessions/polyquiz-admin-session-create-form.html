<!DOCTYPE html>
<dom-module id="polyquiz-admin-session-create-form">
	<link rel="import" href="../../bower_components/paper-radio-group/paper-radio-group.html">
	<link rel="import" href="../polyquiz-dropdown-input.html">

	<style is="custom-style">
		paper-material {
			background-color: white;
			margin-top: 5px;
			margin-bottom: 5px;
		}
		.validButton {
			background-color: #4285f4;
			color: rgba(255,255,255,1.00);
		}
	</style>
<template>
	<iron-ajax id="createAjax" url="../../api/1.0/sessions/create.php" handle-as="json" on-response="createResp"></iron-ajax>
	<div class="row">
		<div class="12u"><paper-button on-click="toggleForm" id="createToggleButton" raised>Create New Session</paper-button></div>
		<iron-collapse id="collapse">
			<div class="12u"><paper-input name="sessionname" label="Session Name" on-change="formDataChanged" id="sessionName" style="padding-left:12px; padding-right:12px;"></paper-input></div>
			<div class="12u">
				<iron-ajax id="housesAjax" url="../../api/1.0/houses/houses.php" handle-as="json" on-response="housesResp" auto></iron-ajax>
				<polyquiz-dropdown-input id="houseSelector" name="house" objects="[[houses]]" defaulttext="Select A House" raised on-selected-changed="formDataChanged"></polyquiz-dropdown-input>
			</div>
			<div class="12u">
				<iron-ajax id="allquizInfoAjax" url="../../api/1.0/quiz/owned.php" handle-as="json" on-response="quizInfoResp" auto></iron-ajax>
				<polyquiz-dropdown-input id="quizSelector" name="quiz" objects="[[quizzes]]" defaulttext="Select A Quiz" raised on-selected-changed="formDataChanged"></polyquiz-dropdown-input>
			</div>
			<div class="12u">
				<div class="row">
					<div class="12u">
						<paper-radio-group selected="open" id="status">
							<paper-radio-button name="open">Open</paper-radio-button>
							<paper-radio-button name="closed">Closed</paper-radio-button>
						</paper-radio-group>
					</div>
					<div class="12u">
						<paper-radio-group selected="show" id="show">
							<paper-radio-button name="show">Show Scores</paper-radio-button>
							<paper-radio-button name="dontshow">Don't Show Scores</paper-radio-button>
						</paper-radio-group>
					</div>
				</div>
			</div>
			<paper-button raised id="submitButton" class="" on-click="reqSubmit">Create</paper-button>
			<paper-button raised id="reset" class="" on-click="resetForm">Reset</paper-button>
		</iron-collapse>
	</div>
</template>
<script>
Polymer({
	is: "polyquiz-admin-session-create-form",
		properties: {
		quizzes: Object,
		houses: Object,
		selectedquiz: String,
		selectedhouse: String,
		sessionname: String,
		
	},
	toggleForm: function(e){
		this.$.collapse.toggle();
		if(this.$.collapse.opened){
			this.$.createToggleButton.raised = false;
		} else {
			this.$.createToggleButton.raised = true;
		}
	},
	housesResp: function(e){
		if(e.detail.response){
			console.log(e);
			var arr = [];
			var roww = function(id, text){
					this.id = id;
					this.text = text;
				};
			for(var x = 0; x < e.detail.response.length; x++){
				var tis = e.detail.response[x];
				arr.push(new roww(tis.data.houseId, tis.data.houseName));
			}
			if(arr.length > 0){
				this.houses = arr;
			}
		}
	},
	quizInfoResp: function(e){
		if(e.detail.response){
			var arr = [];
			var roww = function(id, text){
					this.id = id;
					this.text = text;
				};
			for(var x = 0; x < e.detail.response.length; x++){
				var tis = e.detail.response[x];
				arr.push(new roww(tis.uuid, tis.name));
			}
			if(arr.length > 0){
				this.quizzes = arr;
			}
		}
	},
	reqSubmit: function(e){
		this.$.createAjax.params = {
			sessionname: this.$.sessionName.value,
			house: this.$.houseSelector.value,
			quiz: this.$.quizSelector.value,
			status: this.$.status.selected,
			show: this.$.show.selected
		};
		this.$.createAjax.generateRequest();
		console.log(this.$.sessionName.value + " " + this.$.houseSelector.value + " " + this.$.quizSelector.value + " " + this.$.status.selected + " " + this.$.show.selected);
	},
	createResp: function(e){
		
		if(e.detail.response.status === true){
			this.resetForm();
			this.fire('firetoast', { message: "Created a new Session!"});
			this.fire("reload-sessions", { });
		} else {
			this.fire('firetoast', { message: "FAILED to create a new Session!"});
		}
		
		console.log(e);
	},
	resetForm: function(e){
		this.$.sessionName.value = "";
		this.$.houseSelector.selected = -1;
		this.$.quizSelector.selected = -1;
		this.$.status.selected = "open";
		this.$.show.selected = "show";
	},
	test: function(e){
		console.log(e);
	},
	formDataChanged: function(e){
		if(this.$.houseSelector.selected !== -1 && this.$.quizSelector.selected !== -1 && this.$.sessionName.value.length > 0){
			this.$.submitButton.style.backgroundColor = "#4285f4";
			this.$.submitButton.style.color = "white";
			this.$.submitButton.disabled = false;
		} else {
			this.$.submitButton.style.backgroundColor = "#eaeaea";
			this.$.submitButton.style.color = "#a8a8a8";
			this.$.submitButton.disabled = true;
		}
	},
	ready: function(){
		this.formDataChanged();
	}
});
</script>
</dom-module>