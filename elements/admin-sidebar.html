<!doctype html>
<dom-module id="admin-login">
	<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">

	<style is="custom-style">
		form {
			margin-left: 10px;
			margin-right: 10px;
		}
		paper-spinner {
			width: 19px;
			height: 19px;
		}
	</style>

	<template>
		<iron-ajax id="loginAjax" method="POST" handle-as="json" on-request="reqCB" on-response="loginCallback" url="../api/1.0/admin/login.php"></iron-ajax>
		<form id="adminlogin">
			<paper-input id="user" name="user" label="Username" on-input="loginFieldsCheck"></paper-input>
			<paper-input id="pass" name="pass" label="Password" on-input="loginFieldsCheck" type="password"></paper-input>
			<paper-button id="loginButton" on-click="submitLogin" raised disabled><paper-spinner id="loginSpinner" style="display:none;"></paper-spinner><span>[[buttonText]]</span></paper-button>
		</form>
	</template>

	<script>
		Polymer({
			is: "admin-login",
			properties: {
				sidebarpage: {
					type: Number,
					value: 0
				},
				buttonText: {
					type: String,
					value: "Login"
				}
			},
			loginFieldsCheck: function(e) {
				if(this.$.user.value.length > 0 && this.$.pass.value.length > 0){
					this.$.loginButton.disabled = false;
				} else {
					this.$.loginButton.disabled = true;
				}
			},
			submitLogin: function() {
				this.$.loginButton.disabled = true;

				this.$.loginSpinner.style.display = "inline-block";
				this.buttonText = "";

				this.$.loginSpinner.active = true;
				
				
				this.$.loginAjax.body = JSON.stringify({'user': this.$.user.value, 'pass': this.$.pass.value });
				this.$.loginAjax.generateRequest();
				//document.getElementById('adminlogin').submit();
			},
			reqCB: function(details) {
				console.log(details);
			},
			loginCallback: function(details) {

				if(details.detail.response != null) {
					if(details.detail.response.status) {

					} else {
						this.$.pass.value = "";
						this.fire('firetoast', { message: "Invalid Username And/Or Password!"});
					}
				} else {
					this.fire('firetoast', { message: "Failed To Login! Server Encountered an Error!"});
				}

				this.$.loginSpinner.active = false;

				this.$.loginSpinner.style.display = "none";
				this.buttonText = "Login";

				this.$.loginButton.disabled = false;
			},
			ready: function() {
				
			}
		});
	</script>
</dom-module>
<dom-module id="admin-sidebar">
	<link rel="import" href="../bower_components/paper-input/paper-input.html">
	<link rel="import" href="../bower_components/polymer/polymer.html">
	<link rel="import" href="../bower_components/paper-drawer-panel/paper-drawer-panel.html">
	<link rel="import" href="../bower_components/paper-button/paper-button.html">
	<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
	<link rel="import" href="../bower_components/paper-material/paper-material.html">
	<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
	<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
	<link rel="import" href="../bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
	<link rel="import" href="../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
	<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
	<link rel="import" href="../bower_components/paper-menu/paper-menu.html">
	<link rel="import" href="../bower_components/paper-item/paper-item.html">
	<link rel="import" href="../bower_components/paper-item/paper-icon-item.html">
	<link rel="import" href="../bower_components/paper-styles/paper-styles.html">
	<link rel="import" href="../bower_components/paper-drawer-panel/paper-drawer-panel.html">
	<link rel="import" href="../bower_components/paper-toast/paper-toast.html">
	<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
	<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
	<style>
		:host {
			--paper-item-min-height: 32px;
		}
	</style>
	<template>
		<paper-menu id="sidebarAdminMenu">
			<paper-item on-click="goAdminHome"><i class="fa fa-cog"></i> Quick Start Guide</paper-item>
			<paper-progress value="100" style="width:90%; margin-left:5%; margin-right: 5%;"></paper-progress>
			<paper-item on-click="goEditSessions"><i class="fa fa-cog"></i> Edit Sessions</paper-item>
			<paper-item on-click="goPendingSessions"><i class="fa fa-cog"></i> Quizzes In Progress</paper-item>
			<paper-progress value="100" style="width:90%; margin-left:5%; margin-right: 5%;"></paper-progress>
			<paper-item on-click="goEditQuizzes"><i class="fa fa-cog"></i> My Quizzes</paper-item>
			<paper-progress value="100" style="width:90%; margin-left:5%; margin-right: 5%;"></paper-progress>
			<paper-item on-click="goGrading"><i class="fa fa-cog"></i> Pending Free Response Grading</paper-item>
			<paper-item on-click="goLogout">Logout</paper-item>
		</paper-menu>
	</template>
	<script>
	Polymer({
		is: "admin-sidebar",
		listeners: {
			"toastEvent": "fireToast"
		},
		properties: {
			sidebarpage: {
				type: Number,
				value: 0
			},
			page: {
				type: String,
				value: ""
			}
		},
		goAdminHome: function(){
			window.location = "?p=admin";
		},
		goEditSessions: function(){
			window.location = "?p=sessions";
		},
		goPendingSessions: function(){
			window.location = "?p=pendingsessions";
		},
		goEditQuizzes: function(){
			window.location = "?p=quizadmin";
		},
		goResults: function(){
			window.location = "?p=results";
		},
		goGrading: function(){
			window.location = "?p=gradefr";
		},
		goLogout: function(){
			window.location = "../api/1.0/admin/logout.php";
		},
		fireToastNonEvent: function(text){
			this.$.globalToast.text = text;
			this.$.globalToast.show();
		},
		fireToast: function(vars){
			this.$.globalToast.text = vars.detail.toastString;
			this.$.globalToast.show();
		},
		ready: function() {
			if(this.page != ""){
				switch(this.page){
					case "admin":
						this.$.sidebarAdminMenu.select(0);
						break;
					case "sessions":
						this.$.sidebarAdminMenu.select(2);
						break;
					case "pendingsessions":
						this.$.sidebarAdminMenu.select(3);
						break;
					case "quizadmin":
					case "managequiz":
						this.$.sidebarAdminMenu.select(5);
						break;
					case "results":
						this.$.sidebarAdminMenu.select(7);
						break;
					case "gradefr":
						this.$.sidebarAdminMenu.select(8);
						break;
				}
			}
			
		},
		onresp: function(){
			//this.fireToastNonEvent(this.$.mainPanel.narrow);
			this.fire('iron-signal', {name: 'hideshowevent', data: { show: this.$.mainPanel.narrow } });
			if(this.$.mainPanel.narrow){
				
			//	this.$.scrollHeader.scrollAwayTopbar = true;
			} else {
			//	this.$.scrollHeader.fixed = true;
			}
		}
	});
	</script>
	
</dom-module>