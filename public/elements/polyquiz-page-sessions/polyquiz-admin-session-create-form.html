<!DOCTYPE html>
<dom-module id="polyquiz-admin-session-create-form">
	<link rel="import" href="../../bower_components/paper-radio-group/paper-radio-group.html">
	<link rel="import" href="../polyquiz-dropdown-input.html">

	<style is="custom-style">
		.nomargins { 
			margin: 0px;
		}
		paper-dialog {
			background-color: white;
		}
		.validButton {
			background-color: #4285f4;
			color: rgba(255,255,255,1.00);
		}
		paper-button {
			margin-top: 8px;
		}
	</style>
<template>
	<paper-dialog id="mainDialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation">
		<div class="layout vertical">
		<div class="layout horizontal">
			<div class="flex"></div>
				<h2 class="nomargins">Create New Session</h2>
			<div class="flex"></div>
		</div>
		
		<iron-ajax id="createAjax" url="../../api/1.0/sessions/create.php" handle-as="json" on-response="createResp"></iron-ajax>

		<paper-input name="sessionname" label="Session Name" on-change="formDataChanged" id="sessionName" style="padding-left:12px; padding-right:12px;"></paper-input>
		<polyquiz-dropdown-input id="houseSelector" name="house" objects="[[_computeHouseData(houseData)]]" defaulttext="Select A House" raised on-selected-changed="formDataChanged"></polyquiz-dropdown-input>
		<iron-ajax id="allquizInfoAjax" url="../../api/1.0/quiz/owned.php" handle-as="json" on-response="quizInfoResp" auto></iron-ajax>
		<polyquiz-dropdown-input id="quizSelector" name="quiz" objects="[[quizzes]]" defaulttext="Select A Quiz" raised on-selected-changed="formDataChanged"></polyquiz-dropdown-input>

		<paper-radio-group selected="open" id="status" class="layout horizontal">
			<paper-radio-button name="open">Open</paper-radio-button>
			<paper-radio-button name="closed">Closed</paper-radio-button>
		</paper-radio-group>
		<paper-radio-group selected="show" id="show" class="layout horizontal">
			<paper-radio-button name="show">Show Scores</paper-radio-button>
			<paper-radio-button name="dontshow">Don't Show Scores</paper-radio-button>
		</paper-radio-group>
		<div class="layout horizontal">
			<div class="flex"></div>
			<paper-button raised id="submitButton" class="" on-click="reqSubmit">Create</paper-button>
			<paper-button raised id="reset" class="" on-click="resetForm">Reset</paper-button>
			<paper-button raised dialog-dismiss>Cancel</paper-button>
			<div class="flex"></div>
		</div>
		
		</div>
	</paper-dialog>
</template>
<script>
Polymer({
	is: "polyquiz-admin-session-create-form",
	properties: {
		quizzes: Object,
		houseData: {
			type: Object
		},
		selectedquiz: String,
		selectedhouse: String,
		sessionname: String
		
	},
	open: function() {
		this.$.mainDialog.open();
	},
	_computeHouseData: function(e) {
		var arr = [];
		var roww = function(id, text){
			this.id = id;
			this.text = text;
		};
		for(var key in e) {
			if(e.hasOwnProperty(key)) {
				var o = e[key];
				arr.push(new roww(o.id, o.name));
			}
		}
		return arr;
	},
	quizInfoResp: function(e){
		console.log(e.detail.response);
		if(e.detail.response){
			var arr = [];
			var roww = function(id, text){
					this.id = id;
					this.text = text;
				};
			for(var x = 0; x < e.detail.response.length; x++){
				var tis = e.detail.response[x];
				arr.push(new roww(tis.uuid, tis.name));
			}
			if(arr.length > 0){
				this.quizzes = arr;
			}
		}
	},
	reqSubmit: function(e){
		this.$.createAjax.params = {
			sessionname: this.$.sessionName.value,
			house: this.$.houseSelector.value,
			quiz: this.$.quizSelector.value,
			status: this.$.status.selected,
			show: this.$.show.selected
		};
		this.$.createAjax.generateRequest();
		console.log(this.$.sessionName.value + " " + this.$.houseSelector.value + " " + this.$.quizSelector.value + " " + this.$.status.selected + " " + this.$.show.selected);
	},
	createResp: function(e){
		
		if(e.detail.response.status === true){
			this.resetForm();
			this.fire('firetoast', { message: "Created a new Session!"});
			this.fire("reload-sessions", { });
		} else {
			this.fire('firetoast', { message: "FAILED to create a new Session!"});
		}
		
		console.log(e);
	},
	resetForm: function(e){
		this.$.sessionName.value = "";
		this.$.houseSelector.selected = -1;
		this.$.quizSelector.selected = -1;
		this.$.status.selected = "open";
		this.$.show.selected = "show";
	},
	test: function(e){
		console.log(e);
	},
	formDataChanged: function(e){
		if(this.$.houseSelector.selected !== -1 && this.$.quizSelector.selected !== -1 && this.$.sessionName.value.length > 0){
			this.$.submitButton.style.backgroundColor = "#4285f4";
			this.$.submitButton.style.color = "white";
			this.$.submitButton.disabled = false;
		} else {
			this.$.submitButton.style.backgroundColor = "#eaeaea";
			this.$.submitButton.style.color = "#a8a8a8";
			this.$.submitButton.disabled = true;
		}
	},
	ready: function(){
		this.formDataChanged();
	}
});
</script>
</dom-module>